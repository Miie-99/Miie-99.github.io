<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒäººå¥³è·³å‘æ¨¡æ‹Ÿå™¨ (Modular Refactor)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f3f4f6; overflow: hidden; }
        
        /* --- UI ç»„ä»¶æ ·å¼ --- */
        .uma-header { background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%); }
        .stat-bar-bg { background-color: #e5e7eb; border-radius: 9999px; height: 8px; overflow: hidden; }
        .stat-bar-fill { height: 100%; border-radius: 9999px; transition: width 0.5s ease-in-out; }
        
        /* è€è™æœºæ ·å¼ */
        .slot-window {
            height: 50px; overflow: hidden; background: #f0f9ff;
            border: 2px solid #3b82f6; border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; color: #1e40af;
        }
        .scrolling { animation: scrollText 0.1s infinite linear; }

        /* æ¨¡æ€æ¡†åŠ¨ç”» */
        .modal-enter { animation: fadeIn 0.2s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body class="h-screen flex flex-col text-gray-800">

    <!-- ========================================== -->
    <!--               VIEW LAYER (HTML)            -->
    <!-- ========================================== -->

    <!-- SCREEN 1: Setup -->
    <div id="screen-setup" class="flex-1 flex flex-col items-center justify-center p-4 w-full max-w-md mx-auto">
        <div class="bg-white w-full p-6 rounded-xl shadow-xl space-y-4">
            <h1 class="text-2xl font-bold text-center text-blue-600">åŒäººå¥³æ¨¡æ‹Ÿå™¨ <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Re:Dive</span></h1>
            
            <div class="grid grid-cols-2 gap-4">
                <div><label class="text-xs font-bold text-gray-500">æœ¬å‘½CP (æˆ‘æ¨)</label><input type="text" id="inp-cp" value="AB" class="w-full border rounded p-2 mt-1"></div>
                <div><label class="text-xs font-bold text-gray-500">å¯¹å®¶CP (é›·ç‚¹)</label><input type="text" id="inp-rival" value="BA" class="w-full border rounded p-2 mt-1"></div>
            </div>

            <div class="border-t pt-4">
                <p class="text-xs font-bold text-gray-500 mb-2">èº«ä»½æŠ½å¡</p>
                <div class="flex gap-2 mb-3">
                    <div id="slot-prefix" class="slot-window w-1/2">???</div>
                    <div id="slot-role" class="slot-window w-1/2">???</div>
                </div>
                <button onclick="Game.spinIdentity()" id="btn-spin" class="w-full bg-yellow-400 hover:bg-yellow-500 text-yellow-900 font-bold py-2 rounded">ğŸ² æ‘‡å·</button>
            </div>

            <div id="identity-desc" class="hidden text-xs bg-blue-50 p-2 rounded text-blue-700"></div>
            
            <button onclick="Game.start()" id="btn-start" disabled class="w-full bg-gray-400 text-white font-bold py-3 rounded mt-4 transition-colors">å¼€å§‹çˆ¬å‘</button>
        </div>
    </div>

    <!-- SCREEN 2: Main Game -->
    <div id="screen-game" class="hidden flex-col h-full w-full max-w-md mx-auto bg-gray-50 relative">
        <!-- Header Stats -->
        <div class="uma-header p-3 text-white shadow-md z-10">
            <div class="flex justify-between items-end mb-2">
                <div>
                    <div class="text-xs opacity-80"><span id="disp-date">1å¹´1æœˆ</span> | <span id="disp-phase">å…¥å‘</span></div>
                    <div class="font-bold text-lg">SANå€¼: <span id="val-san">100</span></div>
                </div>
                <div class="text-right text-xs">
                    <div>CPçƒ­åº¦ <span id="val-cpheat">0</span></div>
                    <div>æˆ‘çš„çƒ­åº¦ <span id="val-myheat">0</span></div>
                </div>
            </div>
            <!-- Bars -->
            <div class="space-y-1">
                <div class="flex justify-between text-xs"><span>å¨åŠ›(Love)</span><span id="val-love">50</span></div>
                <div class="stat-bar-bg"><div id="bar-love" class="stat-bar-fill bg-pink-400" style="width: 50%"></div></div>
                <div class="flex justify-between text-xs"><span>äº§å‡ºåŠ›(Tech)</span><span id="val-tech">10</span></div>
                <div class="stat-bar-bg"><div id="bar-tech" class="stat-bar-fill bg-blue-400" style="width: 10%"></div></div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 overflow-y-auto p-3 relative flex flex-col">
            <!-- Resources -->
            <div class="grid grid-cols-4 gap-2 mb-3 text-xs font-bold text-gray-600 bg-white p-2 rounded shadow-sm">
                <div class="text-center"><i data-lucide="zap" class="inline w-3"></i> <span id="val-passion">100</span></div>
                <div class="text-center"><i data-lucide="battery" class="inline w-3"></i> <span id="val-stamina">100</span></div>
                <div class="text-center"><i data-lucide="coins" class="inline w-3"></i> <span id="val-money">1000</span></div>
                <div class="text-center"><i data-lucide="users" class="inline w-3"></i> <span id="val-social">50</span></div>
            </div>

            <!-- Target -->
            <div class="bg-yellow-50 border border-yellow-200 p-2 rounded text-xs text-yellow-800 mb-3 flex justify-between items-center">
                <span>ğŸ¯ ç›®æ ‡: åŠå¹´æœ¬å®£</span>
                <span>è¿›åº¦: <span id="val-works">0</span>/3</span>
            </div>

            <!-- Log Area -->
            <div class="flex-1 bg-white border rounded-lg p-3 shadow-inner overflow-y-auto max-h-[40vh]" id="game-log">
                <div class="text-center text-gray-400 text-xs mt-4">--- æ•…äº‹å¼€å§‹ ---</div>
            </div>
        </div>

        <!-- Action Dock -->
        <div class="bg-white border-t p-3 pb-6">
            <div class="grid grid-cols-3 gap-2">
                <!-- Row 1 -->
                <button onclick="Game.action('work')" class="action-btn bg-green-50 border-green-200 text-green-800 hover:bg-green-100">
                    <div class="font-bold text-sm">ğŸ¢ ç°å……/æ‰“å·¥</div>
                    <div class="text-[10px] opacity-70">é‡‘é’±â†‘ ç¤¾äº¤â†‘</div>
                </button>
                <button onclick="Game.action('create')" class="action-btn bg-blue-50 border-blue-200 text-blue-800 hover:bg-blue-100">
                    <div class="font-bold text-sm">ğŸ¨ äº§ç²®/çº¦ç¨¿</div>
                    <div class="text-[10px] opacity-70">çƒ­åº¦â†‘ æŠ€æœ¯â†‘</div>
                </button>
                <button onclick="Game.action('consume')" class="action-btn bg-pink-50 border-pink-200 text-pink-800 hover:bg-pink-100">
                    <div class="font-bold text-sm">ğŸ¬ å—‘ç³–/çˆ¬æ¥¼</div>
                    <div class="text-[10px] opacity-70">å¨åŠ›â†‘ Sanâ†“</div>
                </button>
                <!-- Row 2 -->
                <button onclick="Game.action('social')" class="action-btn bg-purple-50 border-purple-200 text-purple-800 hover:bg-purple-100">
                    <div class="font-bold text-sm">ğŸ’¬ æ··åœˆ/æ‰©åˆ—</div>
                    <div class="text-[10px] opacity-70">çƒ­åº¦â†‘ é£é™©â†‘</div>
                </button>
                <button onclick="Game.action('rest')" class="action-btn bg-gray-100 border-gray-300 text-gray-800 hover:bg-gray-200">
                    <div class="font-bold text-sm">ğŸ›Œ ç¡è§‰/é€€ç½‘</div>
                    <div class="text-[10px] opacity-70">ä½“åŠ›â†‘ Sanâ†‘</div>
                </button>
                <button onclick="UI.toggleStatus()" class="bg-yellow-50 border border-yellow-200 rounded flex flex-col items-center justify-center hover:bg-yellow-100">
                    <i data-lucide="clipboard-list" class="w-5 h-5 text-yellow-600"></i>
                    <div class="text-[10px] text-yellow-800">çŠ¶æ€</div>
                </button>
            </div>
        </div>
    </div>

    <!-- SCREEN 3: Ending -->
    <div id="screen-end" class="hidden fixed inset-0 bg-gray-900 z-50 overflow-y-auto flex flex-col items-center py-10">
        <div class="bg-gray-800 text-white p-6 rounded-xl max-w-md w-[90%] border border-gray-600">
            <h2 class="text-2xl font-bold text-center text-yellow-400 mb-2" id="end-title">ç»“å±€æ ‡é¢˜</h2>
            <p class="text-center text-gray-400 text-sm italic mb-6" id="end-desc">ç»“å±€æè¿°</p>
            
            <div class="flex justify-center mb-6">
                <svg id="radar-chart" width="200" height="200" viewBox="0 0 200 200"></svg>
            </div>

            <div class="bg-gray-900 p-3 rounded text-sm space-y-2 mb-4">
                <div class="flex justify-between border-b border-gray-700 pb-1"><span>æœ€ç»ˆçƒ­åº¦</span><span id="end-stat-heat" class="text-red-400"></span></div>
                <div class="flex justify-between border-b border-gray-700 pb-1"><span>äº§å‡ºä½œå“</span><span id="end-stat-works" class="text-blue-400"></span></div>
                <div class="flex justify-between"><span>å­˜æ¬¾ç»“ä½™</span><span id="end-stat-money" class="text-green-400"></span></div>
            </div>
            <button onclick="location.reload()" class="w-full bg-blue-600 py-3 rounded font-bold hover:bg-blue-500">å†æ¬¡å…¥å‘</button>
        </div>
    </div>

    <!-- Event Modal -->
    <div id="modal-event" class="hidden fixed inset-0 bg-black/60 z-40 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-sm w-full p-5 shadow-2xl modal-enter">
            <h3 id="evt-title" class="font-bold text-lg text-gray-800 mb-2">äº‹ä»¶æ ‡é¢˜</h3>
            <p id="evt-text" class="text-sm text-gray-600 mb-4 leading-relaxed">äº‹ä»¶å†…å®¹...</p>
            <div id="evt-effects" class="text-xs bg-gray-50 p-2 rounded mb-4 space-y-1 text-gray-500"></div>
            <button onclick="UI.closeModal()" class="w-full bg-gray-800 text-white py-2 rounded hover:bg-gray-700">ç¡®å®š</button>
        </div>
    </div>

    <!-- JavaScript Modules -->
    <script src="script/data.js"></script>
    <script src="script/state.js"></script>
    <script src="script/logic.js"></script>
    <script src="script/ui.js"></script>
    <script src="script/main.js"></script>
    
    <!-- Initialize Lucide Icons -->
    <script>lucide.createIcons();</script>

</body>
</html>
